{% extends "base.html" %}

{% set page_title = 'Results.' %}

{% block content %}
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span3">
      <div class="well sidebar-nav pre-scrollable">
        <ul class="nav nav-list">
          <li class="nav-header">Sources (RA,DEC)</li>
		  <!-- add class="active" to add highlighting -->
		  {% for spec_id in spec_ids %}
            <li><a href="#" onclick="draw_spectrum({{ spec_id }})">Source {{ loop.index }}</a></li>
		  {% endfor %}
        </ul>
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span9">
      <div class="hero-unit" id="main_hero">
		<!-- draw our line plot -->
      </div>
      <div class="row-fluid">
        <div class="span4">
          <h2>Zeropoint Estimates</h2>
          <p>Here, I'll include the calculated ZP estimate, if given instrumental mags and a band
	         on the previous page.  Also include info for each band of the given source.</p>
        </div><!--/span-->
        <div class="span8">
          <h2>Histogram</h2>
		  <p>Put a histogram here (if given instrumental mags).  Otherwise, include and image
			 of the selected source.</p>
        </div><!--/span-->
      </div><!--/row-->
    </div><!--/span-->
  </div><!--/row-->
</div><!--/container-->

<!-- Load all js -->
<script src="static/d3.v2.js"></script>

<!-- THE LINE PLOT -->
<script type="text/javascript">
// margins & size
var margin = {top: 10, right: 10, bottom: 10, left: 70},
    width = 600 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

// scales
var xScale = d3.scale.linear()
    .range([0, width]);
var yScale = d3.scale.linear()
    .range([height, 0]);

// axis generators
var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom")
	.ticks(5);
var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left")
	.ticks(5);

// a line generator, called below
var line = d3.svg.line()
    .x(function(d) { return xScale(d.x); })
    .y(function(d) { return yScale(d.y); });

// the main image -- data added below in json call
var svg = d3.select("#main_hero").append("svg")
    .attr("height", "50%")
    .attr("width", "100%")
	.attr("viewBox", "0 0 600 300")
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");	

// insert the (empty) lines and axes into svg
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")");
svg.append("g")
    .attr("class", "y axis");
svg.append("path")
    .attr("class", "line");

// generate the axes and the line plot with json call:
function draw_spectrum( spec_id ) {
		d3.json( "{{ url_for('serve_spectrum') }}?spec="+spec_id, function(data) {
			// parse the domains, and put into the scales
			xScale.domain([ d3.min(data, function(d){ return d.x;}), d3.max(data, function(d){return d.x;}) ]);
			yScale.domain([ d3.min(data, function(d){ return d.y;}), d3.max(data, function(d){return d.y;}) ]);

			// bind the data to our line plot, using the line generator above
			svg.select("path.line").data( [data] );

			// finally, draw the image
			draw();
		});
};

function draw() {
	svg.select("g.x.axis").call(xAxis);
	svg.select("g.y.axis").call(yAxis);
	svg.select("path.line").attr("d", line);
}
</script>

{% endblock %}
